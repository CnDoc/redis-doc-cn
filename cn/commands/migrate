<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <link href='../styles.css?1333128600' rel='stylesheet' type='text/css' />
    <link href='../images/favicon.png' rel='shortcut icon' />
    <link href='../opensearch.xml' rel='search' title='Look up a Redis command' type='application/opensearchdescription+xml' />
    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js'></script>
    <script async='async' defer='defer' src='../app.js?1375789679'></script>
    <meta content='width=device-width, minimum-scale=1.0, maximum-scale=1.0' name='viewport' />
    <title>
      MIGRATE – Redis
    </title>
    <script type='text/javascript'>
      //<![CDATA[
         var _gaq = _gaq || [];
         _gaq.push(['_setAccount', 'UA-20243082-1']);
         _gaq.push(['_trackPageview']);
        
         (function() {
           var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
           ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
           var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
         })();
      //]]>
    </script>
  </head>
  <body class=''><style type="text/css">#modify_div {position: fixed;right: 0px;top: 50px;	background-color: #000000;	height: 30px;width: 100px;border-top-width: 2px;border-right-width: 2px;border-bottom-width: 2px;border-left-width: 2px;border-top-style: dashed;border-right-style: none;border-bottom-style: dashed;border-left-style: dashed;border-top-color: #333333;border-right-color: #333333;border-bottom-color: #333333;border-left-color: #333333;}#modify {display: block;position: fixed;right: 23px;top: 60px;color: #FFFFFF;text-decoration: none;font-size: 12px;font-weight: bold;}#modify:hover {text-decoration: underline;}</style><div id="modify_div"></div><a href="https://github.com/jialechan/redis-doc-cn/edit/gh-pages/cn/commands/migrate" id="modify" target="_blank">修改本页</a><script>$('#modify_div').css('opacity', '0.6');	</script>
    <header>
      <div class='container'>
        <a href='../index.html'>
          <img alt='Redis' height='30' src='../images/redis.png' width='93' />
        </a>
        <nav>
          <a href='../commands'>Commands</a>
          <a href='../clients'>Clients</a>
          <a href='../documentation'>Documentation</a>
          <a href='../community'>Community</a>
          <a href='../download'>Download</a>
          <a href='https://github.com/antirez/redis/issues'>Issues</a>
          <a href='../support'>Support</a>
          <a href='../topics/license'>License</a>
        </nav>
      </div>
    </header>
    <div class='text'>
      <h1 class='command'>
        <span class='name'>MIGRATE</span>
        <span class='arg'>host</span>
        <span class='arg'>port</span>
        <span class='arg'>key</span>
        <span class='arg'>destination-db</span>
        <span class='arg'>timeout</span>
        <span class='arg'>[COPY]</span>
        <span class='arg'>[REPLACE]</span>
      </h1>
      <article>
        <aside>
          <h2>
            Related commands
          </h2>
          <ul>
            <li>
              <a href='del'>
                DEL
              </a>
            </li>
            <li>
              <a href='dump'>
                DUMP
              </a>
            </li>
            <li>
              <a href='exists'>
                EXISTS
              </a>
            </li>
            <li>
              <a href='expire'>
                EXPIRE
              </a>
            </li>
            <li>
              <a href='expireat'>
                EXPIREAT
              </a>
            </li>
            <li>
              <a href='keys'>
                KEYS
              </a>
            </li>
            <li>
              <a href='migrate'>
                <strong>MIGRATE</strong>
              </a>
            </li>
            <li>
              <a href='move'>
                MOVE
              </a>
            </li>
            <li>
              <a href='object'>
                OBJECT
              </a>
            </li>
            <li>
              <a href='persist'>
                PERSIST
              </a>
            </li>
            <li>
              <a href='pexpire'>
                PEXPIRE
              </a>
            </li>
            <li>
              <a href='pexpireat'>
                PEXPIREAT
              </a>
            </li>
            <li>
              <a href='pttl'>
                PTTL
              </a>
            </li>
            <li>
              <a href='randomkey'>
                RANDOMKEY
              </a>
            </li>
            <li>
              <a href='rename'>
                RENAME
              </a>
            </li>
            <li>
              <a href='renamenx'>
                RENAMENX
              </a>
            </li>
            <li>
              <a href='restore'>
                RESTORE
              </a>
            </li>
            <li>
              <a href='scan'>
                SCAN
              </a>
            </li>
            <li>
              <a href='sort'>
                SORT
              </a>
            </li>
            <li>
              <a href='ttl'>
                TTL
              </a>
            </li>
            <li>
              <a href='type'>
                TYPE
              </a>
            </li>
          </ul>
        </aside>
        <div class='metadata'>
          <p><strong>Available since 2.6.0.</strong></p>
          <p><strong>Time complexity:</strong> This command actually executes a DUMP+DEL in the source instance, and a RESTORE in the target instance. See the pages of these commands for time complexity. Also an O(N) data transfer between the two instances is performed.</p>
        </div>
        <p>Atomically transfer a key from a source Redis instance to a destination Redis
        instance.
        On success the key is deleted from the original instance and is guaranteed to
        exist in the target instance.</p>
        
        <p>The command is atomic and blocks the two instances for the time required to
        transfer the key, at any given time the key will appear to exist in a given
        instance or in the other instance, unless a timeout error occurs.</p>
        
        <p>The command internally uses <a href="dump">DUMP</a> to generate the serialized version of the key
        value, and <a href="restore">RESTORE</a> in order to synthesize the key in the target instance.
        The source instance acts as a client for the target instance.
        If the target instance returns OK to the <a href="restore">RESTORE</a> command, the source instance
        deletes the key using <a href="del">DEL</a>.</p>
        
        <p>The timeout specifies the maximum idle time in any moment of the communication
        with the destination instance in milliseconds.
        This means that the operation does not need to be completed within the specified
        amount of milliseconds, but that the transfer should make progresses without
        blocking for more than the specified amount of milliseconds.</p>
        
        <p><a href="migrate">MIGRATE</a> needs to perform I/O operations and to honor the specified timeout.
        When there is an I/O error during the transfer or if the timeout is reached the
        operation is aborted and the special error - <code>IOERR</code> returned.
        When this happens the following two cases are possible:</p>
        
        <ul>
        <li>The key may be on both the instances.</li>
        <li>The key may be only in the source instance.</li>
        </ul>
        
        <p>It is not possible for the key to get lost in the event of a timeout, but the
        client calling <a href="migrate">MIGRATE</a>, in the event of a timeout error, should check if the
        key is <em>also</em> present in the target instance and act accordingly.</p>
        
        <p>When any other error is returned (starting with <code>ERR</code>) <a href="migrate">MIGRATE</a> guarantees that
        the key is still only present in the originating instance (unless a key with the
        same name was also <em>already</em> present on the target instance).</p>
        
        <p>On success OK is returned.</p>
        
        <h2>Options</h2>
        
        <ul>
        <li><code>COPY</code> -- Do not remove the key from the local instance.</li>
        <li><code>REPLACE</code> -- Replace existing key on the remote instance.</li>
        </ul>
        
        <p><code>COPY</code> and <code>REPLACE</code> will be available in 3.0 and are not available in 2.6 or 2.8 </p>
        
        <h2>Return value</h2>
        
        <p><a href="../topics/protocol#simple-string-reply">Simple string reply</a>: The command returns OK on success.</p>
      </article>
    </div>
    <div class='text' id='comments'>
      <div id='disqus_thread'></div>
      <script type='text/javascript'>
        //<![CDATA[
          var disqus_shortname = 'redisio';
          
          // The following are highly recommended additional parameters. Remove the slashes in front to use.
          var disqus_identifier = 'command_migrate';
          var disqus_url = 'http://redis.io/commands/migrate';
          
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        //]]>
      </script>
      <a class='dsq-brlink' href='http://disqus.com'>
        Comments powered by
        <span class='logo-disqus'>
          Disqus
        </span>
      </a>
    </div>
    <footer>
      <p>
        This website is
        <a href="https://github.com/antirez/redis-io">open source software</a>
        developed by <a href="http://citrusbyte.com">Citrusbyte</a>.
        <br> The Redis logo was designed by <a href="http://www.carlosprioglio.com/">Carlos Prioglio</a>. See more <a href="../topics/sponsors">credits</a>.
      </p>
      <div class='sponsor'>
        Sponsored by
        <a href='http://www.gopivotal.com/products/redis'>
          <img alt='Redis Support' height='25' src='../images/pivotal.png' title='Redis Sponsor' width='99' />
        </a>
      </div>
    </footer>
  </body>
</html>
<script type="text/javascript">
lloogg_clientid = "20bb9c026e";
</script>
<script type="text/javascript" src="http://demo.lloogg.com/l.js?c=20bb9c026e">
</script>
