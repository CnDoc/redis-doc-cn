<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <link href='../styles.css%3F1333128600.css' rel='stylesheet' type='text/css' />
    <link href='../images/favicon.png' rel='shortcut icon' />
    <link href='../opensearch.xml' rel='search' title='Look up a Redis command' type='application/opensearchdescription+xml' />
    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js'></script>
    <script async='async' defer='defer' src='../app.js%3F1375789679'></script>
    <meta content='width=device-width, minimum-scale=1.0, maximum-scale=1.0' name='viewport' />
    <title>
      CONFIG REWRITE – Redis
    </title>
    <script type='text/javascript'>
      //<![CDATA[
         var _gaq = _gaq || [];
         _gaq.push(['_setAccount', 'UA-20243082-1']);
         _gaq.push(['_trackPageview']);
        
         (function() {
           var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
           ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
           var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
         })();
      //]]>
    </script>
  </head>
  <body class=''><style type="text/css">#modify_div {position: fixed;right: 0px;top: 50px;	background-color: #000000;	height: 30px;width: 100px;border-top-width: 2px;border-right-width: 2px;border-bottom-width: 2px;border-left-width: 2px;border-top-style: dashed;border-right-style: none;border-bottom-style: dashed;border-left-style: dashed;border-top-color: #333333;border-right-color: #333333;border-bottom-color: #333333;border-left-color: #333333;}#modify {display: block;position: fixed;right: 23px;top: 60px;color: #FFFFFF;text-decoration: none;font-size: 12px;font-weight: bold;}#modify:hover {text-decoration: underline;}</style><div id="modify_div"></div><a href="https://github.com/jialechan/redis-doc-cn/edit/gh-pages/cn/redis.io/commands/config-rewrite.html" id="modify" target="_blank">修改本页</a><script>$('#modify_div').css('opacity', '0.6');	</script>
    <header>
      <div class='container'>
        <a href='../index.html'>
          <img alt='Redis' height='30' src='../images/redis.png' width='93' />
        </a>
        <nav>
          <a href='../commands.html'>Commands</a>
          <a href='../clients.html'>Clients</a>
          <a href='../documentation.html'>Documentation</a>
          <a href='../community.html'>Community</a>
          <a href='../download.html'>Download</a>
          <a href='https://github.com/antirez/redis/issues'>Issues</a>
          <a href='../support.html'>Support</a>
          <a href='../topics/license.html'>License</a>
        </nav>
      </div>
    </header>
    <div class='text'>
      <h1 class='command'>
        <span class='name'>CONFIG REWRITE</span>
      </h1>
      <article>
        <aside>
          <h2>
            Related commands
          </h2>
          <ul>
            <li>
              <a href='bgrewriteaof.html'>
                BGREWRITEAOF
              </a>
            </li>
            <li>
              <a href='bgsave.html'>
                BGSAVE
              </a>
            </li>
            <li>
              <a href='client-getname.html'>
                CLIENT GETNAME
              </a>
            </li>
            <li>
              <a href='client-kill.html'>
                CLIENT KILL
              </a>
            </li>
            <li>
              <a href='client-list.html'>
                CLIENT LIST
              </a>
            </li>
            <li>
              <a href='client-pause.html'>
                CLIENT PAUSE
              </a>
            </li>
            <li>
              <a href='client-setname.html'>
                CLIENT SETNAME
              </a>
            </li>
            <li>
              <a href='cluster-slots.html'>
                CLUSTER SLOTS
              </a>
            </li>
            <li>
              <a href='command.html'>
                COMMAND
              </a>
            </li>
            <li>
              <a href='command-count.html'>
                COMMAND COUNT
              </a>
            </li>
            <li>
              <a href='command-getkeys.html'>
                COMMAND GETKEYS
              </a>
            </li>
            <li>
              <a href='command-info.html'>
                COMMAND INFO
              </a>
            </li>
            <li>
              <a href='config-get.html'>
                CONFIG GET
              </a>
            </li>
            <li>
              <a href='config-resetstat.html'>
                CONFIG RESETSTAT
              </a>
            </li>
            <li>
              <a href='config-rewrite.html'>
                <strong>CONFIG REWRITE</strong>
              </a>
            </li>
            <li>
              <a href='config-set.html'>
                CONFIG SET
              </a>
            </li>
            <li>
              <a href='dbsize.html'>
                DBSIZE
              </a>
            </li>
            <li>
              <a href='debug-object.html'>
                DEBUG OBJECT
              </a>
            </li>
            <li>
              <a href='debug-segfault.html'>
                DEBUG SEGFAULT
              </a>
            </li>
            <li>
              <a href='flushall.html'>
                FLUSHALL
              </a>
            </li>
            <li>
              <a href='flushdb.html'>
                FLUSHDB
              </a>
            </li>
            <li>
              <a href='info.html'>
                INFO
              </a>
            </li>
            <li>
              <a href='lastsave.html'>
                LASTSAVE
              </a>
            </li>
            <li>
              <a href='monitor.html'>
                MONITOR
              </a>
            </li>
            <li>
              <a href='role.html'>
                ROLE
              </a>
            </li>
            <li>
              <a href='save.html'>
                SAVE
              </a>
            </li>
            <li>
              <a href='shutdown.html'>
                SHUTDOWN
              </a>
            </li>
            <li>
              <a href='slaveof.html'>
                SLAVEOF
              </a>
            </li>
            <li>
              <a href='slowlog.html'>
                SLOWLOG
              </a>
            </li>
            <li>
              <a href='sync.html'>
                SYNC
              </a>
            </li>
            <li>
              <a href='time.html'>
                TIME
              </a>
            </li>
          </ul>
        </aside>
        <div class='metadata'>
          <p><strong>Available since 2.8.0.</strong></p>
        </div>
        <p>The <code>CONFIG REWRITE</code> command rewrites the <code>redis.conf</code> file the server was started with, applying the minimal changes needed to make it reflecting the configuration currently used by the server, that may be different compared to the original one because of the use of the <code>CONFIG SET</code> command.</p>
        
        <p>The rewrite is performed in a very conservative way:</p>
        
        <ul>
        <li>Comments and the overall structure of the original redis.conf are preserved as much as possible.</li>
        <li>If an option already exists in the old redis.conf file, it will be rewritten at the same position (line number).</li>
        <li>If an option was not already present, but it is set to its default value, it is not added by the rewrite process.</li>
        <li>If an option was not already present, but it is set to a non-default value, it is appended at the end of the file.</li>
        <li>Non used lines are blanked. For instance if you used to have multiple <code>save</code> directives, but the current configuration has fewer or none as you disabled RDB persistence, all the lines will be blanked.</li>
        </ul>
        
        <p>CONFIG REWRITE is also able to rewrite the configuration file from scratch if the original one no longer exists for some reason. However if the server was started without a configuration file at all, the CONFIG REWRITE will just return an error.</p>
        
        <h2>Atomic rewrite process</h2>
        
        <p>In order to make sure the redis.conf file is always consistent, that is, on errors or crashes you always end with the old file, or the new one, the rewrite is perforemd with a single <code>write(2)</code> call that has enough content to be at least as big as the old file. Sometimes additional padding in the form of comments is added in order to make sure the resulting file is big enough, and later the file gets truncated to remove the padding at the end.</p>
        
        <h2>Return value</h2>
        
        <p><a href="../topics/protocol.html#simple-string-reply">Simple string reply</a>: <code>OK</code> when the configuration was rewritten properly.
        Otherwise an error is returned.</p>
      </article>
    </div>
    <div class='text' id='comments'>
      <div id='disqus_thread'></div>
      <script type='text/javascript'>
        //<![CDATA[
          var disqus_shortname = 'redisio';
          
          // The following are highly recommended additional parameters. Remove the slashes in front to use.
          var disqus_identifier = 'command_config rewrite';
          var disqus_url = 'http://redis.io/commands/config-rewrite';
          
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        //]]>
      </script>
      <a class='dsq-brlink' href='http://disqus.com'>
        Comments powered by
        <span class='logo-disqus'>
          Disqus
        </span>
      </a>
    </div>
    <footer>
      <p>
        This website is
        <a href="https://github.com/antirez/redis-io">open source software</a>
        developed by <a href="http://citrusbyte.com">Citrusbyte</a>.
        <br> The Redis logo was designed by <a href="http://www.carlosprioglio.com/">Carlos Prioglio</a>. See more <a href="../topics/sponsors.html">credits</a>.
      </p>
      <div class='sponsor'>
        Sponsored by
        <a href='http://www.gopivotal.com/products/redis'>
          <img alt='Redis Support' height='25' src='../images/pivotal.png' title='Redis Sponsor' width='99' />
        </a>
      </div>
    </footer>
  </body>
</html>
<script type="text/javascript">
lloogg_clientid = "20bb9c026e";
</script>
<script type="text/javascript" src="http://demo.lloogg.com/l.js?c=20bb9c026e">
</script>
